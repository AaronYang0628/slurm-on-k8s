apiVersion: slurm.ay.dev/v1
kind: SlurmDeployment
metadata:
  labels:
    app.kubernetes.io/name: operator
    app.kubernetes.io/managed-by: kustomize
  name: slurmdeployment
spec:
  chart:
    name: chart
    repository: https://aaronyang0628.github.io/slurm-on-k8s
    version: 1.0.2
    namespace: slurm
  values:
    mariadb:
      enabled: true
      port: 3306
      primary:
        persistence:
          enabled: false
          storageClass: ""
          size: 8Gi
    auth:
      ssh:
        configmap:
          name: slurm-ssh-auth-keys
          prefabPubKeys: ["ssh-rsa sample_public_key"]
    persistence:
      shared:
        enabled: true
        accessModes:
          - ReadWriteMany
        name: slurm-shared-storage
        storageClass: ""
        size: 8Gi
    munged:
      image:
        registry: "docker-registry.lab.zverse.space"
        repository: data-and-computing/slurm-munged
        tag: :intelmpi-250208-r0
        pullPolicy: IfNotPresent
        pullSecrets: []
      extraVolumes: []
      extraVolumeMounts: []
    slurmdbd:
      image:
        registry: "docker-registry.lab.zverse.space"
        repository: data-and-computing/slurm-slurmdbd
        tag: :intelmpi-250208-r0
        pullPolicy: IfNotPresent
        pullSecrets: []
      extraVolumes: []
      extraVolumeMounts: []
    slurmctld:
      image:
        registry: "docker-registry.lab.zverse.space"
        repository: data-and-computing/slurm-slurmctld
        tag: :intelmpi-250208-r0
        pullPolicy: IfNotPresent
        pullSecrets: []
      extraVolumes: []
      extraVolumeMounts: []
      checkDns:
        image:
          registry: docker.io
          repository: library/busybox
          tag: 1.37.0-glibc
          pullPolicy: IfNotPresent
          pullSecrets: []
    login:
      image:
        registry: "docker-registry.lab.zverse.space"
        repository: data-and-computing/slurm-login
        tag: :intelmpi-250208-r0
        pullPolicy: IfNotPresent
        pullSecrets: []
      resources: 
        limits:
          cpu: 3000m
          ephemeral-storage: 50Gi
          memory: 8Gi
        requests:
          cpu: 1000m
          ephemeral-storage: 8Gi
          memory: 1Gi
      extraVolumes: []
      extraVolumeMounts: []
    slurmd:
      replicaCount: 1
      image:
        registry: "docker-registry.lab.zverse.space"
        repository: data-and-computing/slurm-slurmd
        tag: :intelmpi-250208-r0
        pullPolicy: IfNotPresent
        pullSecrets: []
      resources: 
        requests:
          cpu: 1000m
          ephemeral-storage: 10Gi
          memory: 4Gi
      extraVolumes: []
      extraVolumeMounts: []

  